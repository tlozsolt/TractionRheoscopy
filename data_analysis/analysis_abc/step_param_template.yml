name: 'stepe'
step: 'e'
nameLong: 'tfrGel10212018A_shearRun10292018e' # long name used in dpl locating
frames: 64 # nubmer of frames for this step

paths:
  stem: './'
  sed: './sed_stitched.h5'
  gel: './gel_stitched.h5'
  reference_sed_pos: '../tfrGel10212018A_shearRun10292018ref/sed_stitched.h5'
  reference_gel_pos: '../tfrGel10212018A_shearRun10292018ref/gel_stitched.h5'
  sed_interface_idx: './ovito/sed_complete_bottom_surface.xyz'
  reference_sed_interface_idx: '../tfrGel10212018A_shearRun10292018ref/ovito/sed_complete_bottom_surface.xyz'
  interfaceFits: './sed_gel_interfaceFits.h5'
  dplMetaData: './tfrGel10212018A_shearRun10292018e_metaData.yaml'
  dpl_log: './log/'
  locationCSV: './locations/tfrGel10212018A_shearRun10292018e_locations_hv{:05}_{}_trackPy_lsqRefine.csv'
  figPath: './plots/'
  strainDataDir: './strainData/'
  topIdx:
    init: './ovito/sed_t000_topSurface.xyz'
    final: './ovito/sed_t063_topSurface.xyz'
  
stitchTrack:
  pipeline:
    qc: True
    stitch: True
    track: True
  stitch: {}
  qc: {}
  track: {}
  linking:
    max_disp: {'gel': 1.4, 'sed':1.0}
    param:
      neighbor_strategy: 'KDTree'
      pos_columns : ['z (um, imageStack)', 'y (um, imageStack)', 'x (um, imageStack)']
      t_column: 'frame'
      adaptive_stop: 0.1
      adaptive_step: 0.95

dimensions:
  x (um): 235
  y (um): 235

cleaning:
  fitSurface:
    mat: 'sed'
    coordStr: '(um, imageStack)'
    add2Inst: True
    save2HDF: True
    forceRecompute: True
  fitReference:
    coordStr: '(um, imageStack)'
    add2Inst: True
  cleanSedGel:
    pos_keys: ['z (um, imageStack)', 'y (um, imageStack)', 'x (um, imageStack)']
    dist_key: 'dist from sed_gel interface (um, imageStack)'
    keepBool_str: 'cleanSedGel_keepBool'
    garbage:  {'sed_sed': -1.0, 'sed_gel': -1.5, 'gel_gel' : nan, 'gel_sed': nan  }
    forceRecompute: True
    description: |
      garbage key is parameters used to split particle locations into clean and garbage.
      if sediment particles are less than sed_sed distance below (meaning more negative) than cut off,
      you are clearly in the gel. The terminology is fitPlane_material so sed_gel is sedimentFitPlane and gel material
      I probably wont used gel_* for anything as the fits are expected to be worse that sediment fits.
  xyzClean:
    fNameFlag: ''
    keySet : ['locations_rheoSedHeight', 'locations_imageStack', 'uncertainty']
    extraCols : ['dist from sed_gel interface (um, imageStack)']
    keepBool_str: 'cleanSedGel_keepBool'
    forceWrite: True

  ovito_interfaceFit:
    description: |
      Find the interface by fitting planes to particle ids output from ovito
      fitSurface function uses the particle ids manually found using the following parameters
      in ovito. The particles ids as stored in [paths][sed_interface_idx] as output from ovito
    ovito_param:
        x: 0.00848448
        y: -0.0167703
        z: 0.999823
        distance: 27.6
        slab_width: 1.45
        coordStr: '(um, imageStack)'
strain:
  verbose: False
  posCoordinateSystem:
    posKey_frmt: '{coord} ({units}, {coordSys})'
    coordTuple: ['z','y','x']
    units: 'um'
    coordSys: 'rheo_sedHeight'
  strainTypes: ['atomicStrainOvito','falkLanger','boundary']
  key_frmt: 'ref{ref:03}/cur{cur:03}/{strainType}' # for saving to hdf
  posKeySet: ['locations_rheoSedHeight']
  keepBool: 'cleanSedGel_keepBool'

  falkLanger:
    nnb_cutoff: 2.2
    verbose: False
  boundary:
    description: 'compute the strain from relative displacement of lower and upper boundaries of sediment'

