# traction force rheology metaData template
filePaths:
  fName_prefix: deconScriptHashing_ # filename_prefix
  #
  metaDataYaml_MBP: /Users/zsolt/Colloid/SCRIPTS/shearRun09102018h_metaData_scriptTesting.yaml #path to this file
  metaDataYaml_ODSY: /path/to/yaml/on/odsy
  # raw tiff files for importing
  rawTiff_MBP: /Users/zsolt/Colloid/DATA/DeconvolutionTesting_Huygens_DeconvolutionLab2/OddysseyHashScripting/rawImageSeries #path for input raw Tiff files for MacBookPro
  rawTiff_SS: /path/to/tiff/image/sequence #path for input raw Tiff files for Storage Server
  rawTiff_ODSY: /n/spaepen_lab/zsolt/DATA # ... for Odyssey shared storage filesystem
  #
  # dark images for importing
  darkTiff_MBP: /Users/zsolt/Colloid/DATA/testImagesCodeDebug/calibration/darkImage_65ms_camera2922_zStack.tif
  darkTiff_SS: /path/to/dark/storage/server/stack
  darkTiff_ODSY: /n/spaepen_lab/zsolt/calibration/darkImage_65ms_camera2922_1024px_20190430
  #
  # psf path, input
  psfPath_MBP: /Users/zsolt/Colloid/DATA/psf
  psfPath_SS: /path/to/psf/files/on/storage/server
  psfPath_ODSY: /n/spaepen_lab/zsolt/psf/psf_dim1024x1024
  # currently only contains type gel stacks with 209 zslices
  # sample every 10 um from 100um to 200 um real sample depth
  #
  # image output paths
  # scratchDirectory is temporary but specific to this metaData file.
  #   This parent directory is created to hold tiff files that are produced during intermediate stages of
  #   image processing and are too large and numerous for long term storage.
  #   You could however, in principle, recompute all
  #   intermediate stages given the rawTiff (which is archived on storage server) and the analysis scripts that are
  #   saved in the project directory (see below)
  scratchDirectory_MBP: /Users/zsolt/Colloid/DATA/DeconvolutionTesting_Huygens_DeconvolutionLab2/OddysseyHashScripting
  scratchDirectory_SS: /path/to/working/directory/specific/to/this/metaData/file
  scratchDirectory_ODSY: /parent/scratch/directory/where/intermediate/results/will/be/saved/without/longterm/backup

  # projectDirectory is permanent and specific to this metaDataFile
  projectDirectory_MBP: /Users/zsolt/Colloid/DATA/DeconvolutionTesting_Huygens_DeconvolutionLab2/OddysseyHashScripting
  projectDirectory_ODSY: /n/spaepen_lab/zsolt

  scratchSubDirList:
    - preprocessing
    - decon
    - postDecon
    - flatField
    - rawTiff

  projectSubDirList:
    - metaDataYAML
    - psfPath
    - darkTiff
    - fullStackPath
    - calibration # includes rheology, notes, piezo position
    - dplPath


  preprocessOutPath_MBP: /Users/zsolt/Colloid/DATA/DeconvolutionTesting_Huygens_DeconvolutionLab2/OddysseyHashScripting/preprocessingOut #subdirectories will be created for each hashvalue
  preprocessOutPath_SS: /path/to/output/parent/output/directory #subdirectories will be created for each hashvalue
  preprocessOutPath_ODSY: /path/to/output/parent/output/directory/on/odyssey
  #
  flatField_MBP: /Users/zsolt/Colloid/DATA/DeconvolutionTesting_Huygens_DeconvolutionLab2/OddysseyHashScripting/flatField
  flatField_SS: /path/to/working/directory/specific/to/this/metaData/file/flatField
  flatField_ODSY: /parent/scratch/directory/where/intermediate/results/will/be/saved/without/longterm/backup/flatField
  #
  deconOutPath_MBP: /Users/zsolt/Colloid/DATA/DeconvolutionTesting_Huygens_DeconvolutionLab2/OddysseyHashScripting/deconOut #subdirectories will be created for each hashvalue
  deconOutPath_SS: /path/to/output/parent/output/directory #subdirectories will be created for each hashvalue
  deconOutPath_ODSY: /path/to/output/parent/output/directory/on/odyssey
  #
  postDeconOutPath_MBP: /Users/zsolt/Colloid/DATA/DeconvolutionTesting_Huygens_DeconvolutionLab2/OddysseyHashScripting/postDeconOut #subdirectories will be created for each hashvalue
  postDeconOutPath_SS: /path/to/output/parent/output/directory #subdirectories will be created for each hashvalue
  postDeconOutPath_ODSY: /path/to/output/parent/output/directory/on/odyssey
  #
  # output parent directories for particle locations, before trajectory linking
  locationsHashed_MBP: /Users/zsolt/Colloid/DATA/DeconvolutionTesting_Huygens_DeconvolutionLab2/OddysseyHashScripting/locationsHashed
  locationsHashed_SS: /path/to/particle/locations/output # subdirectories will be created
  locationsHashed_ODSY: /path/to/particle/locations/output # subdirectories will be created
  #
  # path to master dpl bash execute script
  dplPath_MBP: /Users/zsolt/Colloid/DATA/DeconvolutionTesting_Huygens_DeconvolutionLab2/OddysseyHashScripting/dplScripts
  dplPath_SS: /path/to/decon/particle/locating/top/level/bash/script
  dplPath_ODSY: /path/to/decon/particle/locating/top/level/bash/script
  # 
  # calibration data
  gelRheology: /path/to/gel/rheology/on/stoargeServer/
  experimentTable: /path/to/table/of/shearParameters/
  piezoPath: /path/to/piezo/motion/output/and/control/files/
  fullStackPath: /path/to/full/zStacks/to/determine/absolute/gel/and/sediment/and/grid/locations/
  notesPath: /path/to/notes/during/image/acquisition/
  #
  # software paths
  fijiPath_MBP: /Applications/Fiji.app/Contents/MacOS/ImageJ-macosx # note this is an executable
  fijiPath_ODSY: /path/to/fiji/on/odyssyey/ # Check that the fast FFT libraries are also installed
  matlabPath_ODSY: /path/to/MATLAB/if/not/standard/modulue/
  matlabPath_MBP: /Applications/MATLAB_R2018b.app/bin/matlab
  particleLocatingSCRIPTS_MBP: /Users/zsolt/Colloid/SCRIPTS/dpl_locatingScripts
  DL2Path_ODSY: /path/to/deconLab2/jar/file
  DL2Path_MBP: /Applications/Fiji.app/plugins
  javaPath_MBP: java
  javaPath_ODSY: java
fileNamePrefix:
  global: shearRun09052019b_shearRun05062019i_
  preprocessing: preProcess_
  decon: decon_
  postDecon: postDecon8Bit_
  location: locations_
  flatField: flatField_
  metaDataYAML: metaData_
  rawTiff: tfrGel09052019b_shearRun05062019i_ # may not be necessary as I only read from the raw directory and never write to it.
  dplPath: dplScript_
fileExtensions:
   preprocessingOut: .tif
   deconOut: .tif
   postDeconOut: .tif
   flatField: .tif
   rawTiff: .tif
   metaDataYAML: .yaml
   psfPath: .tif
   darkTiff: .tif
   fullStackPath: .tif
   calibration: .text # includes rheology, notes, piezo position, its not clear that all the files will have this extension.
   dplPath: .x


#######
#######
imageParam:
  xDim: 1024 # full image dimension in x direction, units of pixels
  yDim: 1024 # ...and in in y
  zDim: 597 # number of z -slices
  timeSteps: 2 # total number of number of time steps
  shearTime: [1, 226] # shear start and stop timesteps assuming zero indexing
  px2Micron: [0.230, 0.230, 0.15] # list of multiplicative factors to convert px to micron
  stackTime: 176 # time to acquire a stack in seconds
  stackInterval: 180 # time between successive stacks, note: stackInterval > stackTime
  gelSedimentLocation: 190 # location in z of gel/sediment transition in imaging stack. If tilted, report center of transition
  gelSedimentLocation_fullStack: 0 # location of gel/sediment transition in full stack image, not imaging stack
  piezoPos: # position of the objective piezo as read off optical encoder at various locations
    imageStackBottom: 220 
    imageStackTop: 350
    coverslip: 100
    gelSediment: 245
#######
#######
shearParam:
  exptIntention: strain sweep to locate yield point # shear processing to crystallize, oscillatory rheology at freq, etc
  waveform: triangle # triangle, triangle wave, sine, ...
  velocity: 0.00000 # velocity of plate in microns per second
  a: 0.000000 # step size, typical target is two steps per second given serial bandwidth 
  oscillations: 1 # number of repeated oscillations 
#######
#######
imageRestoration:
  software: ImageJ
  cropBool: True # is the image cropped prior to background subtraction? 
  bkSubtractBool: True # is the background subtracted prior to deconvolution?
  deconBool: True
  bkSubtractMethod: gaussian # method names, rbFilter, gaussian
  params:
    width: 40 # width of gaussian in pixels
    32BitFloat: True
    16BitConv: True
flatField:
  software: python
  cropXY_bool: False
  returnType: uint16 # after flatfielding what the is the data type of a single pixel? unit16 in "unisgned 16 bit integer"
  flatStack_method: gaussianBlur # description of how the the flatStack is formed. Either a guassian blur or an actual microscope image of an optical phantom
  sigma: 50 # standard deviation of gaussian used
  dim: 2D # slice by slice in 2D or full 3D?
  darkFrame_method: darkStackAvg
deconvolution:
  deconCropXDim: 1024 # size of cropped section for deconvolution
  deconCropYDim: 1024 # size of cropped section for deconvolution
  deconCropZDimSediment: 190 # size of cropped section for deconvolution
  deconCropZDimGel: 190 # size of cropped section for deconvolution
  minXOverlap: 0 # minimum required x-overlap between chunks
  minYOverlap: 0 # minimum required x-overlap between chunks
  minZOverlap: 30 # minimum required Z-overlap between chunks
  software: DeconvolutionLab2 # string saying what software was used to carry out decon
  method: RLTV # string specifying deconvolution method, probably Richardson-Lucy with Total Variation Regularization
  iterations: 40 # number of iterations for deconvolution
  lambda: 0.00001 # regularization parameter
  psf_info: theorectical generated by Huygens
  path2PSF: see filePaths.psfPath_ODSY
  garbageSlices: 2 # number of z-slices to discard after deconvolution
  apodization:
    bool: True
    lateral: HAMMING
    axial: 'NO'
  padding:
    bool: True
    lateral: E2
    axial: E2
postDecon:
  postDeconBool: True
  threshold32Bit_SED: [20000.00, 150000.00] # Set by looking at the raw values of the deconvolved image
  threshold32Bit_GEL: [30000.00, 100000.00]
#######
#######
locating:
  locatingScriptPath: /path/to/matlab/locating/and/submission/scripts/used/
  matlabVariable: [] # list of key:value pairs for all the variables matlab needs to run
  bandPassBool: False # does the locating code cary out a band pass filter for any reason? 
  deconvolvedBool: True # is the image deconvolved prior to locating?
  iterBool: True # use iterative locating?
  sedimentParam: # list of particle locations for locating the sediment 
    outputSuffix: _sed 
    lnoise: [0.9, 0.9, 0.7] # I dont actually think this is used since the images wont be bandpass filtered
    lobject: [27, 27, 27] # Only used if image is bandpass filtered
    diameters: [13, 13, 17] # somewhat larger than feature size 
    mask_size: [9, 9, 13] # somewhat smaller than feature size 
    min_separation: [5, 5, 9] # merge two local maxima if within this distance. Set equal to smaller than core size
    masscut_initial: 0 # initial mass cut
    masscut_residuals: 3000000 # mass cut during interative locativing
    false_particle_size: [17, 17, 19] # for core shell this should be somewhat smaller than
                                      # 2*(nearest neighbor distance)- (core diameter)
    bridgeThreshold: 0.5 # i dont think this is used either
    zeroPxThreshold: 200 # max overlap with zero pixels
  gelParam: #list of particle location values used for locating the gel particles
    outputSuffix: _gel 
    lnoise: [0.9, 0.9, 0.7] # I dont actually think this is used since the images wont be bandpass filtered
    lobject: [27, 27, 27]
    diameters: [31, 31, 33]
    mask_size: [23, 23, 25]
    min_separation: [19, 19, 21] # These should comparitively large relative to the diameters since the gel is sparse. 
    masscut_initial: 0 # initial mass cut
    masscut_residuals: 3000000 # mass cut during interative locativing
    false_particle_size: [29, 29, 29]
    bridgeThreshold: 0.5 # i dont think this is used either
    zeroPxThreshold: 200 # mobject: [27, 27, 29]
ODSY_Resources:
  queue: serial_requeue 
  time: 360 # requested time in units of minutes
  cores: 1 # number of requested cores
  mem: 16000 # memory pool for all cores in units of Mb
